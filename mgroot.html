<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <!-- title and icon -->
    <title>MG-RAST</title>
    <link rel="icon" href="images/MGRAST_favicon.ico" type="image/x-icon">

    <!-- default js -->
    <script type="text/javascript" src="Retina/js/jquery.min.js"></script>
    <script type="text/javascript" src="js/config.js"></script>
    <script type="text/javascript" src="Retina/js/stm.js"></script>
    <script type="text/javascript" src="Retina/js/retina.js"></script>
    <script type="text/javascript" src="Retina/js/bootstrap.min.js"></script>

    <!-- newsfeed read via google jsapi -->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
    google.load("feeds", "1");
function showNewsFeed () {
    var feed = new google.feeds.Feed("http://press.igsb.anl.gov/mg-rast/feed/");
    feed.load(function(result) {
	if (!result.error) {
	    var html = '<table class="table table-condensed" style="width: 100%; font-size: 12px;">';
	    for (var i = 0; i < result.feed.entries.length; i++) {
		var entry = result.feed.entries[i];
		var date = entry.publishedDate.replace(/^(\w+,\s\d+\s\w+\s\d+).+$/, "$1");
		html += '<tr><td style="white-space: nowrap;">'+date+'</td><td><a href="'+entry.link+'" target=_blank>'+entry.title+'</a></td></tr>';
	    }
	    html += "</table>";
	    document.getElementById("newsfeed").innerHTML = html;
	}});
}
google.setOnLoadCallback(showNewsFeed); 
    </script>

    <!-- bootstrap style -->
    <link rel="stylesheet" type="text/css" href="Retina/css/bootstrap.min.css">

    <!-- webapp initialization -->
    <script type="text/javascript">
    jQuery( document ).ready(function(){
	// keybind for searchbox
	document.getElementById('searchtext').addEventListener("keypress", function(event){
	    event=event || window.event;
	    if(event.keyCode=='13') {
		document.getElementById('searchbutton').click();
	    }
	});

	// server status info
	jQuery.getJSON("http://api.metagenomics.anl.gov/server/MG-RAST", function (data) {
	    // check if the server is down
	    if (data.status != "ok") {
		document.getElementById('searchdiv').style.display = "none";
		document.getElementById('navdiv').style.display = "none";
		document.getElementById('error').innerHTML = data.info;
		document.getElementById('error').style.display = "";
	    }
	    // check if there is an info message
	    else if (data.info) {
		document.getElementById('info').innerHTML = data.info;
		document.getElementById('info').style.display = "";
	    }

	    // print server version
	    document.getElementById('version').innerHTML = "version "+data.version;

	    // print server stats
	    var bp = (parseInt(data.basepairs) / 1000000000000).formatString(2);
	    var seq = parseInt(parseInt(data.sequences) / 1000000000).formatString();
	    document.getElementById('load').innerHTML = parseInt(data.metagenomes).formatString()+" metagenomes containing "+seq+" billion sequences and "+bp+" Tbp processed.";
	});

	// webapp initialization
	stm.init(RetinaConfig.mgrast_api, true, "MG-RAST");
	Retina.init( { library_resource: "Retina/js/" } ).then( function() {
	    Retina.add_widget({"name": "login", "resource": "Retina/widgets/",  "filename": "widget.login.js"});
	    Retina.load_widget("login").then( function() {
		Retina.Widget.create('login', { "target": document.getElementById("login_space"),
	    					"authResources": { "default": "MG-RAST",
	    							   "MG-RAST": { "icon": "MGRAST_favicon.ico",
	    									"prefix": "mggo4711" } } });
	    });
	    
	    Retina.add_widget({"name": "session", "resource": "Retina/widgets/",  "filename": "widget.session.js"});
	    Retina.load_widget("session").then( function() {
		Retina.Widget.create('session', {"target": document.getElementById('session_space')});
	    });
	});
    });
    </script>

    <style>
	.ico {
	padding: 10px;
	border-radius: 10px;
	background-image: linear-gradient(to bottom, #CCCCCC, #AAAAAA);
	margin-bottom: 5px;
	opacity: 0.8;
	cursor: pointer;
	width: 32px;
	}

	.ico-small {
	width: 16px;
	}

	.ico:hover {
	opacity: 1;
	}
	
	.icorow {
	margin-left: auto;
	margin-right: auto;
	margin-top: 5px;
	width: 550px;
	}

	.icorow > div {
	float: left;
	}
	
	.icospan {
	text-align: center;
	color: #666;
	margin-top: 30px;
	width: 110px;
	}

	.icospan > span {
	margin-left: 5px;
	color: white;
	font-size: 20px;
	font-weight: 200;
	}
	
	.icoactive {
	opacity: 1;
	cursor: default;
	}

	.icoactivespan > span {
	display: inline;
	}

	.sidebar {
	float: right;
	position: absolute;
	top: 100px;
	bottom: 40px;
	right: 40px;
	box-shadow: 4px 4px 4px #666666;
	padding: 0;
	border: 1px solid #DDDDDD;
	border-radius: 4px;
	overflow-y: auto;
	}

	.tab-pane {
	padding-left: 10px;
	padding-right: 10px;
	}

	body {
	margin-bottom: 100px;
	background-color: #1B1B1B;
	}

	.footer {
	position: absolute;
	bottom: 10px;
	font-size: 11px;
	color: gray;
	width: 100%;
	margin-left: auto;
	margin-right: auto;
	z-index: -1;
	}

	.myData {
	background-color: white;
	width: 550px;
	height: 170px;
	margin-left: auto;
	margin-right: auto;
	margin-bottom: 50px;
	clear: both;
	border-radius: 10px;
	padding-top: 10px;
	padding-left: 10px;
	padding-right: 10px;
	position: relative;
	top: 30px;
	border: 1px solid #666666;
	overflow-y: auto;
	}

	.recent {
	float: left;
	width: 130px;
	margin-right: 20px;
	border: 1px solid #666666;
	box-shadow: 4px 4px 4px #666666;
	padding: 5px;
	text-align: center;
	border-radius: 4px;
	}

	.newsheadline {
	font-weight: bold;
	text-align: center;
	margin-top: -5px; 
	margin-bottom: 5px;
	}

	.rotate {
	transform: rotate(90deg);
	transform-origin: 20% 50%;
	}

	.cite {
	transform: rotate(-25deg);
	background-color: #222222;
	border: 3px solid #808080;
	border-radius: 4px;
	bottom: 19px;
	color: #808080;
	font-weight: 400;
	left: 439px;
	padding-bottom: 2px;
	padding-left: 5px;
	padding-right: 5px;
	position: relative;
	transform: rotate(-25deg);
	width: 43px;
	cursor: pointer;
	}
    </style>
  </head>

  <body>

    <!-- header bar -->
    <div class="container" style="width: 100%;">
      
      <!-- user info / login section -->
      <span id="login_space"></span>
      
      <!-- session management -->
      <span id="session_space" style="float: right; margin-right: 10px;"></span>
    </div>
    
    <div class="content">
      
      <div style="width: 480px; margin-left: auto; margin-right: auto;">
	
	<!-- logo -->
	<img src="images/MGRAST_logo.png" style="height: 120px;"><div class="cite" onclick="window.open('http://www.biomedcentral.com/1471-2105/9/386');">cite us</div>
	<p style="color: gray; margin-bottom: 0px; position: relative; bottom: 30px; text-align: center;" id="version"></p>
	<p style="color: gray; margin-bottom: 0px; position: relative; bottom: 30px; font-size: 12px; text-align: center;" id="load"></p>
	
	<!-- status messages -->
	<div id="info" class="alert alert-info" style="display: none;"></div>
	<div id="error" class="alert alert-error" style="display: none;"></div>
	
	<!-- search -->
	<div id="searchdiv" class="input-append" style="margin-top: 10px; width: 400px; margin-left: auto; margin-right: auto; display: block;">
	  <input class="search span4" type="text" style="padding-left: 10px;border-radius: 14px 0 0 14px;" placeholder="search MG-RAST" id="searchtext">
	  <button class="btn search-button" style="border-radius: 0 14px 14px 0;" onclick="window.open('mgmain.html?mgpage=search&search='+document.getElementById('searchtext').value);" id="searchbutton">search</button>
	</div>
	
	<!-- navigation icons -->
	<div id="navdiv" class="icorow" style="position: relative; right: 40px;">
	  <div class="icospan" id="icon_search"><img src="Retina/images/search.png" class="ico" title="Search" onclick="window.open('mgmain.html?mgpage=search');"><br><span>Search</span></div>
	  <div class="icospan" id="icon_pipeline"><img src="Retina/images/settings3.png" class="ico" title="Submission" onclick="window.open('mgmain.html?mgpage=pipeline');"><br><span>Submission</span></div>
	  <div class="icospan" id="icon_publications"><img src="Retina/images/dna.png" class="ico" title="Publications" onclick="window.open('mgmain.html?mgpage=overview');"><br><span>Publications</span></div>
	  <div class="icospan" id="icon_analysis"><img src="Retina/images/notebook.png" class="ico" title="Analysis" onclick="window.open('mgmain.html?mgpage=analysis');"><br><span>Analysis</span></div>
	  
	  <div class="icospan" id="icon_search"><img src="Retina/images/file-pdf.png" class="ico" title="Handbook" onclick="window.open('ftp://ftp.metagenomics.anl.gov/data/manual/mg-rast-manual.pdf');"><br><span>Handbook</span></div>
	  <div class="icospan" id="icon_pipeline"><img src="Retina/images/wizard.png" class="ico" title="Tutorials" onclick="window.open('https://www.youtube.com/channel/UCoBKJ-yYJu5HK1szy3my91A');"><br><span>Tutorials</span></div>
	  <div class="icospan" id="icon_publications"><img src="Retina/images/bubbles.png" class="ico" title="Forum"><br><span>Forum</span></div>
	  <div class="icospan" id="icon_analysis"><img src="Retina/images/envelop.png" class="ico" title="Feedback"><br><span>Feedback</span></div>
	</div>
	
      </div>
      
      <!-- news -->
      <div class="myData">
	<p class="newsheadline">News</p>
	<div id="newsfeed"><img src="Retina/images/waiting.gif" style="margin-top: 40px; margin-left: 250px;"></div>
      </div>
      
    </div>
    
    <div class="footer">
      <div style="width: 200px; margin-left: auto; margin-right: auto; text-align: center;">
	<a href="#" style="color: gray;">Legal Information | Funding</a>
      </div>
    </div>
  </body>
</html>
