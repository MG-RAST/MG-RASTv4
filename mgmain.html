<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <!-- title and icon -->
    <title>MG-RAST</title>
    <link rel="icon" href="images/MGRAST_favicon.ico" type="image/x-icon">

    <!-- default js -->
    <script src="Retina/js/jquery.min.js"></script>
    <script src="Retina/js/stm.js"></script>
    <script src="Retina/js/retina.js"></script>
    <script src="Retina/js/bootstrap.min.js"></script>

    <!-- config  -->
    <script src="js/config.js"></script>

    <!-- bootstrap style -->
    <link rel="stylesheet" type="text/css" href="Retina/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/mgrast.css">

    <!-- webapp initialization -->
    <script>
    jQuery( document ).ready(function(){
	try {
	    if (window.opener && window.opener.stm) {
		window.stm = window.opener.stm;
	    } else {
		stm.init(RetinaConfig.mgrast_api, true, "MG-RAST");
	    }
	} catch (err) {
	    stm.init(RetinaConfig.mgrast_api, true, "MG-RAST");
	}
	Retina.init( { library_resource: "Retina/js/" } ).then( function() {
	    
	    var page  = Retina.cgiParam("mgpage") || "search";

	    var icons = { "overview": "publications" };
	    var iconame = icons[page] ? icons[page] : page;

	    var ico = document.getElementById('icon_'+iconame);
	    if (ico) {
		ico.className = "icospan icoactivespan";
		ico.firstChild.className = "ico icoactive";
	    }

	    Retina.add_widget({"name": "metagenome_"+page, "resource": "widgets/",  "filename": "widget.metagenome_"+page+".js"});
	    Retina.load_widget("metagenome_"+page).then( function() {
		var mgp = Retina.Widget.create('metagenome_'+page, { "main": document.getElementById("content"),
								     "sidebar": document.getElementById("sidebar") });

		Retina.add_widget({"name": "login", "resource": "Retina/widgets/",  "filename": "widget.login.js"});
		Retina.load_widget("login").then( function() {
		    Retina.Widget.create('login', { "target": document.getElementById("login_space"),
		    				    "callback": mgp.loginAction,
		    				    "authResources": { "default": "MG-RAST",
		    						       "MG-RAST": { "icon": "MGRAST_favicon.ico",
		    								    "prefix": "mggo4711" } },
						    "registerEnabled": true,
						    "registerLink": "mgmain.html?mgpage=register",
						    "forgotEnabled": true,
						    "forgotLink": "mgmain.html?mgpage=register&forgot=1" });
		});

		Retina.add_widget({"name": "session", "resource": "Retina/widgets/",  "filename": "widget.session.js"});
		Retina.load_widget("session").then( function() {
		    Retina.Widget.create('session', {"target": document.getElementById('session_space'), "noInfo": true});
		});
		
	    });
	});
    });
    </script>
  </head>

  <body style="margin-top: 60px; margin-bottom: 100px;">

    <!-- header bar -->
    <div class="navbar navbar-inverse navbar-fixed-top" style="box-shadow: 0 3px 3px #BBBBBB;">
      <div class="navbar-inner">
	<div class="container" style="width: 100%;">

	  <!-- logo and title -->
          <img src="images/MGRAST_logo.png" style="float: left; height: 59px; margin-top: 3px; cursor: pointer;" onclick="window.location='mgroot.html';">
	  
	  <!-- navigation icons -->
	  <div class="icorow">
	    <div class="icospan" id="icon_search"><img src="Retina/images/search.png" class="ico" title="Search" onclick="window.location='mgmain.html?mgpage=search';"><span>Search</span></div>
	    <div class="icospan" id="icon_pipeline"><img src="Retina/images/settings3.png" class="ico" title="Jobs" onclick="window.location='mgmain.html?mgpage=pipeline';"><span>Job Status Monitor</span></div>
	    <div class="icospan" id="icon_publications" onclick="window.location='mgmain.html?mgpage=overview';"><img src="Retina/images/dna.png" class="ico" title="Publications"><span>Publications</span></div>
	    <div class="icospan" id="icon_analysis"><img src="Retina/images/notebook.png" class="ico" title="Analysis" onclick="window.location='mgmain.html?mgpage=analysis';"><span>Analysis</span></div>
	  </div>
	  
	  <!-- user info / login section -->
	  <span id="login_space"></span>

	  <!-- session management -->
	  <span id="session_space" style="float: right; margin-right: 10px;"></span>
	</div>
      </div>
    </div>

    <!--border layout -->
    <div class="borderlayout">
      
      <!-- main content -->
      <div id="content"></div>
    </div>
    
      <!-- sidebar content -->
      <div id="sidebar" class="sidebar span5"></div>
      
  </body>
</html>
